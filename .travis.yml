language: python
python:
  - "3.8"

install:
  - python -m pip install -U pip
  - python setup.py install

services:
  - postgresql

before_script:
  - psql -c "create user_1 with password '12345';" -U postreg
  - psql -c 'create database test;' -U postgres
  - psql -c 'grant all privileges on testdatabase  to user_1;' -U postgres
  - python manage.py db upgrade
  - gunicorn "run:run()"

script:
  - pylint department_app/
  - coverage run setup.py test
after-success:
  - coveralls

notifications:
  - email:
      recipients:
        - ljte823@gmail.com
      on_success: never
      on_failure: always
