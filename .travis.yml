language: python
python:
  - "3.8"

install:
  - python -m pip install -U pip
  - python setup.py install

services:
  - postgresql

before_script:
  - psql -c "CREATE DATABASE test;" -U postgres
  - psql -c "CREATE USER user_1 WITH PASSWORD '12345';" -U postgres
  - python manage.py db upgrade
  - psql -c "INSERT INTO department (id, name) VALUES (1, 'Management department')"
  - psql -c "INSERT INTO employee (id, fullname, bday, salary, department_id) VALUES (1, 'Sergey Nemko', '1998-12-25', 555.0, 1)"

script:
  - pylint department_app/
  - coverage run setup.py test
after-success:
  - coveralls

notifications:
  - email:
      recipients:
        - ljte823@gmail.com
      on_success: never
      on_failure: always
